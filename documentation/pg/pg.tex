\input{../boilerplate/preamble}
\begin{document} 
\renewcommand{\isbn}{978-90-819090-0-6}
\setcounter{tocdepth}{1} 
\title{\nr{}\protect\\Programming Guide}
\author{RexxLA}
\date{Version \nrversion{} of \today}
\maketitle
\pagenumbering{Roman}
\pagestyle{plain}
\frontmatter
\pagenumbering{Roman}
\pagestyle{plain}
\input{../boilerplate/bookmeta}
\tableofcontents
\newpage
\pagenumbering{arabic}
\frontmatter
\large
\input{../boilerplate/series}
\input{../boilerplate/conventions}
\include {introduction}
\mainmatter
\chapter{Meet the Rexx Family}
\section{Once upon a Virtual Machine}
On the 22nd of March 1979, to be precise, Mike Cowlishaw of IBM had a
vision of an easier to use command processor for VM, and wrote down a
specification over the following days.
VM\textsuperscript{\texttrademark} (now called z/VM) is the original Virtual Machine operating system,  stemming from an
era in which time sharing was acknowledged to be the wave of the
future and when systems as CTSS (on the IBM 704) and TSS (on the IBM
360 Family of computers) were early timesharing systems, that offered
the user an illusion of having a large machine for their exclusive
use, but fell short of virtualising the entire hardware. The CP/CMS
system changed this; CP virtualised the hardware completely and CMS was the OS
running on CP. CMS knew a succession of command interpreters, called
EXEC, EXEC2 and Rexx\textsuperscript{\texttrademark}  (originally REX
- until it was found out, by the IBM legal department, that a product of another vendor had a similar name) -
the EXEC roots are the explanation why some people refer to a \nr{}
program as an ``exec''. As a prime example of a \emph{backronym}, Rexx
stands for ``Restructured Extended Executor''. It
can be defended that Rexx came to be as a reaction on EXEC2, but it
must be noted that both command interpreters shipped around the same
time. From 1988 on Rexx was available on MVS/TSO and other systems,
like DOS, Amiga and various Unix systems. Rexx was branded the
official SAA procedures language and was implemented on all IBM's
Operating Systems; most people got to know Rexx on OS/2. In the late
eighties the Object-Oriented successor of Rexx, Object Rexx, was
designed by Simon Nash and his colleagues in the IBM Winchester
laboratory. Rexx was thereafter known as Classic Rexx. Several open
source versions of Classic Rexx were made over the years, of which
Regina is a good example.

\section{Once upon another Virtual Machine}
In 1995 Mike Cowlishaw ported Java\textsuperscript{\texttrademark} to OS/2\textsuperscript{\texttrademark} and soon after started with
an experiment to run Rexx on the JVM\textsuperscript{\texttrademark}. With Rexx generally considered
the first of the general purpose scripting languages, \nr{}\textsuperscript{\texttrademark}  is the
first alternative language for the JVM. The 0.50 release, from April
1996, contained the \nr{} runtime classes and a translator written
in Rexx but tokenized and turned into an OS/2 executable. The 1.00
release came available in January 1997 and contained a translator
bootstrapped to \nr{}. The Rexx string type that can also handle
unlimited precision numerics is called Rexx in Java and \nr{}.
Where Classic Rexx was positioned as a system \emph{glue} language and
application macro language, \nr{} is seen as the one language that
does it all, delivering system level programs or large applications.

Release 2.00 became available in August 2000 and was a major upgrade,
in which interpreted execution was added. Until that release, \nr{}
only knew \emph{ahead of time} compilation (AOT).

Mike Cowlishaw left IBM in March 2010. IBM announced the transfer of \nr{{} source code to the Rexx Language Association (RexxLA) on June 8, 2011, 14 years after the v1.0 release.

On June 8th, 2011, IBM released the \nr{} source code to RexxLA
under the ICU open source license. RexxLA shortly after released this
as \nr{} 3.00 and has followed with updates.
\section{Features of \nr}
\begin{description}
\item[Ease of use]
The \nr{} language is easy to read and write because many instructions are meaningful English words. Unlike some lower level programming languages that use abbreviations, \nr{}instructions are common words, such as \textbf{say}, \textbf{ask}, \textbf{if...then...else}, \textbf{do...end}, and \textbf{exit}.
\item[Free format] There are few rules about \nr{} format. You need not start an instruction in a particular column, you can also skip spaces in a line or skip entire lines, you can have an instruction span many lines or have multiple instructions on one line, variables do not need to be pre-defined, and you can type instructions in upper, lower, or mixed case.
\item[Convenient built-in functions] \nr{} supplies built-in functions
  that perform various processing, searching, and comparison
  operations for both text and numbers. Other built-in functions
  provide formatting capabilities and arithmetic calculations.
\item[Easy to debug]
When a \nr{} exec contains an error, messages with meaningful explanations are displayed on the screen. In addition, the \textbf{trace} instruction provides a powerful debugging tool.
\item[Interpreted]
The \nr{} language is an interpreted language. When a \nr{} exec
runs, the language processor directly interprets each language
statement, or translates the program in JVM bytecode.
\item[Extensive parsing capabilities]
\nr{} includes extensive parsing capabilities for character
manipulation. This parsing capability allows you to set up a pattern
to separate characters, numbers, and mixed input.
\item[Seamless use of JVM Class Libraries]
\nr{} can use any class, and class library for the JVM (written in
Java or other JVM languages) in a seamless manner, that is, without
the need for extra declarations or definitions in the source code.
\end{description}

\chapter{Learning to program}
\section{Console Based Programs}
One way that a computer can communicate with a user is to ask
questions and then compute results based on the answers typed in. In
other words, the user has a conversation with the computer. You can
easily write a list of  \nr{} instructions that will conduct a conversation. We call such a list of instructions a program.
The following listing shows a sample \nr{} program. The sample program asks the user to give his name, and then responds to him by name. For instance, if the user types in the name Joe, the reply Hello Joe is displayed. Or else, if the user does not type anything in, the reply Hello stranger is displayed.
First, we shall discuss how it works; then you can try it out for
yourself.
\begin{lstlisting}[label=hello,caption=Hello Stranger]
/* A conversation */
say "Hello! What's your name?"
who=ask
if who = '' then say "Hello stranger"
else say "Hello" who
\end{lstlisting}
Briefly, the various pieces of the sample program are:
\begin{description}
\item[\texttt{/* ... */}] A comment explaining what the program is
  about. Where Rexx programs on several platforms must start with a comment, this is not
  a hard requirement for \nr{} anymore. Still, it is a good idea to start
  every program with a comment that explains what it does.
\item [\texttt{say}] An instruction to display Hello! What' s your name? on the screen.
\item [\texttt{ask}] An instruction to read the response entered from the keyboard and put it into the computer's memory.
\item [\texttt{who}] The name given to the place in memory where the user's response is put.
\item [\texttt{if}] An instruction that asks a question. 
\item [\texttt{who = ''}] A test to determine if who is empty.
\item [\texttt{then}] A direction to execute the instruction that follows, if the tested condition is true.
\item [\texttt{say}] An instruction to display Hello stranger on the screen.
\item [\texttt{else}] An alternative direction to execute the
  instruction that follows, if the tested condition is not true. Note
  that in \nr{}, else needs to be on a separate line.
\item [\texttt{say}] An instruction to display Hello, followed by whatever is in who on the screen.
\end{description}
The text of your program should be stored on a disk that you have
access to with the help of an \emph{editor} program. On Windows,
notepad or (notepad++), jEdit, X2 or SlickEdit are suitable
candidates. On Unix based systems, including MacOSX, vim or emacs are
plausible editors. If you are on z/VM or z/OS, XEDIT or ISPF/PDF are a
given. More about editing \nr{} code in chapter \ref{editors},
\emph{Editor Support}, on page \pageref{editors}. 

When the text of the program is stored in a file, let's say we called
it \texttt{hello.nrx}, and you installed \nr{} as indicated in the
\emph{\nr{} QuickStart Guide}, we can run it with
\begin{verbatim}
    nrc -exec hello
\end{verbatim}
and this will yield the result:
\begin{alltt}
\nr{} portable processor, version \nr{} after3.01, build 1-20120406-1326
Copyright (c) RexxLA, 2011.  All rights reserved.
Parts Copyright (c) IBM Corporation, 1995,2008.
Program hello.nrx
===== Exec: hello =====
Hello! What’s your name?
\end{alltt}
If you do not want to see the version and copyright message every
time, which would be understandable, then start the program with:
\begin{verbatim}
nrc -exec -nologo hello
\end{verbatim}
This is what happened when Fred tried it.
\begin{verbatim}
Program hello.nrx
===== Exec: hello =====
Hello! What’s your name?
Fred
Hello Fred
\end{verbatim}
The \textbf{ask} instruction paused, waiting for a reply. Fred typed
Fred on the command line and, when he pressed the ENTER key, the
\textbf{ask} instruction put the word Fred into the place in the
computer's memory called ``who''. The \textbf{if} instruction asked,
is ``who'' equal to nothing:
\begin{verbatim}
who = '' 
\end{verbatim}
meaning, is the value of ``who''  (in this case, Fred) equal to
nothing:
\begin{verbatim}
"Fred = ''
\end{verbatim}
This was not true; so, the instruction after \texttt{then} was not executed; but the instruction
after \texttt{else}, was.

But when Mike tried it, this happened:
\begin{verbatim}
Program hello.nrx
===== Exec: hello =====
Hello! What’s your name?

Hello stranger
Processing of 'hello.nrx' complete
\end{verbatim}
Mike did not understand that he had to type in his name. Perhaps the
program should have made it clearer to him. Anyhow, he just pressed
ENTER. The \textbf{ask} instruction put '' (nothing) into the place in the
computer's memory called ``who''. The \textbf{if} instruction asked, is:
\begin{verbatim}
who = ''
\end{verbatim}
meaning, is the value of ``who'' equal to nothing:
\begin{verbatim}
'' = ''
\end{verbatim}
 
In this case, it was true. So, the instruction after \textbf{then} was
executed; but the instruction after \textbf{else} was not.

\section{Comments in programs}
When you write a program, remember that you will almost certainly want to read it over later (before improving it, for example). Other readers of your program also need to know what the program is for, what kind of input it can handle, what kind of output it produces, and so on. You may also want to write remarks about individual instructions themselves. All these things, words that are to be read by humans but are not to be interpreted, are called comments.
To indicate which things are comments, use:
\begin{verbatim}
/* to mark the start of a comment 
*/ to mark the end of a comment.
\end{verbatim}
The \texttt{/*} causes the translator to stop compiling and interpreting;
this starts again only after a \texttt{*/} is found, which may
be a few words or several lines later. For example,
\begin{verbatim}
/* This is a comment. */
say text /* This is on the same line as the instruction */
/* Comments may occupy more
than one line. */

\end{verbatim}
\nr{} also has line mode comments - those turn a line at a time into
a comment. They are composed of two dashes (hyphens, in listings sometimes
fused to a typographical \emph{em dash} - remember that in reality
they are two \emph{n dashes}.
\begin{verbatim}
-- this is a line comment
\end{verbatim}
\section{Strings}
When the translator sees a quote (either " or ') it stops
interpreting or compiling and just goes along looking for the matching quote. The
string of characters inside the quotes is used just as it is. Examples
of strings are:
\begin{verbatim}
'Hello'
"Final result: "
\end{verbatim}
If you want to use a quotation mark within a string you should use
quotation marks of the other kind to delimit the whole string.
\begin{verbatim}
"Don't panic"
'He said, "Bother"'
\end{verbatim}
There is another way. Within a string, a pair of quotes (of the same
kind as was used to delimit the string) is interpreted as one of that
kind.
\begin{verbatim}
'Don''t panic' (same as "Don't panic" )
 "He said, ""Bother""" (same as 'He said, "Bother"')
\end{verbatim}
\section{Clauses}
Your \nr{} program consists of a number of \emph{clauses}. A clause
can be:
\begin{enumerate}
 \item A \emph{keyword instruction} that tells the interpreter to do something; for
   example,
\begin{verbatim}
say  "the word"
\end{verbatim}
In this case, the interpreter will display the word on the user's
screen. 
\item An \emph{assignment}; for example,
\begin{verbatim}
Message = 'Take care!'
\end{verbatim}
\item A \emph{null} clause, such as a completely blank line, or
\begin{verbatim}
    ;
\end{verbatim}
\item A \emph{method call instruction} which invokes a \emph{method}
    from a \emph{class}
\begin{verbatim}
'hiawatha'.left(2)
\end{verbatim}
\end{enumerate}
\section{When does a Clause End?}
It is sometimes useful to be able to write more than one clause on a
line, or to extend a clause over many lines. The rules are:
\begin{itemize}
\item Usually, each clause occupies one line.
\item If you want to put more than one clause on a line you must use a semicolon (;) to separate the clauses.
\item If you want a clause to span more than one line you must put a
  dash (hyphen) at the end of the line to indicate that the clause
  continues on the next line. If a line does not end in a dash, a
  semicolon is implied.
\end{itemize}
What will you see on the screen when this exec is run?
\begin{lstlisting}[label=rah,caption=RAH Exec]
/* Example: there are six clauses in this program */ say "Everybody cheer!"
say "2"; say "4" ; say "6" ; say "8" ; say "Who do we" -
"appreciate?"
\end{lstlisting}
\section{Long Lines}
Since the days of the punch card images are over the lines in program
sources have become longer and longer, and with \nr{} being a free
format language, there is no real technical reason to limit line
length. Still, for readability and for ease access to words within a
line, it is often indicated to keep lines relatively short and
tidy. For this reason, the \emph{continuation character} '-' can be
used. This also makes it possible to split long literal strings over
lines.
\begin{lstlisting}[label=longline,caption=Long lines]
say 'good' - 
'night'
\end{lstlisting}
This example will concatenate 'good' and 'night' with a space
inbetween. When you want to avoid that, use the '||' concatenation
operator.
\begin{lstlisting}[label=longlineconcat,caption=Long lines with string
  concatenation without space]
say 'good' - 
||'night'
\end{lstlisting}

\section{Loops}
We can go on and write clause after clause in a program source files,
but some repetitive actions in which only a small change occurs, are
better handled by the \textbf{loop} statement.
% .reminding
% of an anecdote that Andy Hertzfield tells\footnote{\url{http://www.folklore.org}:
% Bob's background looked to be a lot stronger in hardware than software, so we were somewhat skeptical about his software expertise, but he claimed to be equally adept at both. His latest project was a rebellious, skunk-works type effort to make a low cost version of the Star called "Cub" that used an ordinary Intel microprocessor (the 8086), which was heresy to the PARC orthodoxy, who felt that you needed custom, bit-slice processors to get sufficient performance for a Star-type machine. Bob had written much of the software for Cub himself. 

% "I've got lots of software experience", he declared, "in fact I've personally written over 350,000 lines of code." 

% I thought that was pretty impressive, although I wondered how it was calculated. I couldn't begin to honestly estimate how much code I have written, since there are too many different ways to construe things. 

% That evening, I went out to dinner with my friend Rich Williams, who started at Apple around the same time that I did. Rich had a great sense of humor. I told him about the interview that I did in the afternoon, and how Bob Belleville claimed to have written over 350,000 lines of code. 

% "Well, I bet he did", said Rich, "but then he discovered loops!"}
Imagine an assignment to neatly print out a table of exchange rates for
dollars and euros for reference in a shop. We could of course make the
following program:
\begin{lstlisting}[label=withoutloop,caption=Without a loop]
say  1 'euro equals'  1  * 2.34 'dollars'
say  2 'euro equals'  2  * 2.34 'dollars'
say  3 'euro equals'  3  * 2.34 'dollars'
say  4 'euro equals'  4  * 2.34 'dollars'
say  5 'euro equals'  5  * 2.34 'dollars'
say  6 'euro equals'  6  * 2.34 'dollars'
say  7 'euro equals'  7  * 2.34 'dollars'
say  8 'euro equals'  8  * 2.34 'dollars'
say  9 'euro equals'  9  * 2.34 'dollars'
say 10 'euro equals' 10  * 2.34 'dollars'
\end{lstlisting}
This is valid, but imagine the alarming thought that the list is deemed
a success and you are tasked with making a new one, but now with
values up to 100. That will be a lot of typing.

The way to do this is using the \textbf{loop}\footnote{Note that
  Classic Rexx uses \textbf{do} for this purpose. In recent Open
  Object Rexx versions
  \textbf{loop} can also be used.} statement.
\begin{lstlisting}[label=withoop,caption=With a loop]
loop i=1 to 100
  say i 'euro equals' i * 2.34 'dollars'
end
\end{lstlisting}
Now the \emph{loop index variable} \texttt{i} varies from 1 to 100,
and the statements between \texttt{loop} and \texttt{end} are
repeated, giving the same list, but now from 1 to 100 dollars.

We can do more with the \textbf{loop} statement, it is extremely
flexible. The following diagram is a (simplified, because here we left
out the \emph{catch} and \emph{finally} options) rundown of the ways
we can loop in a program.
\input{../railroad/loop}

A few examples of what we can do with this: 
\begin{itemize}
\item Looping forever - better put, without deciding beforehand how
  many times
\begin{lstlisting}[label=loopforever,caption=Loop Forever]
loop forever
  say 'another bonbon?'
  x = ask
  if x = 'enough already' then leave
end
\end{lstlisting}
The \texttt{leave} statement breaks the program out of the loop. This
seems futile, but in the chapter about I/O we will see how useful this
is when reading files, of which we generally do not know in advance
how many lines we will read in the loop.

\item Looping for a fixed number of times without needing a loop index
  variable
\begin{lstlisting}[label=loopfixed,caption=Loop for a fixed number of
  times without loop index variable]
loop for 10
   in.read() /* skip 10 lines from the input file */
end
\end{lstlisting}
\item Looping back into the value of the loop index variable
\begin{lstlisting}[label=loopforever,caption=Loop Forever]
loop i = 100 to 90 by -2
  say  i
end
\end{lstlisting}
This yields the following output:
\begin{verbatim}
===== Exec: test =====
100
98
96
94
92
90
Processing of 'test.nrx' complete
\end{verbatim}
\end{itemize}

\section{Special Variables}
We have seen that a \emph{variable} is a place where some data, be it
character date or numerical data, can be held. There are some special
variables, as shown in the following program.
\lstinputlisting[label=specialvars,caption=\nr{} Special Variables]{../../../examples/rosettacode/RCSpecialVariables.nrx}
\begin{description}
\item[\texttt{this}] The special variables \textbf{this} and \textbf{super} refer to the
current instance of the class and its superclass - what this means
will be explained in detail in the chapter \textbf{Classes} on page
\pageref{classes}, as is the case with the \textbf{class} variable.

\item[\texttt{digits}]The special variable \textbf{digits} shows the current setting for the
number of decimal digits - the current setting of \textbf{numeric
  digits}. The related variable \textbf{form} returns the current
setting of \textbf{numeric form} which is either \texttt{scientific}
or \texttt{engineering}.

\item[\texttt{null}]The special variable \textbf{null} denotes the \emph{empty
  reference}. It is there when a variable has no value.

\item[\texttt{source}]The \textbf{source} and \textbf{sourceline} variables are a good way to
show the sourcefile and sourceline of a program, for example in an
error message.

\item[\texttt{trace}]The \textbf{trace} variable returns the current trace setting, which
can be one of the words \texttt{off var methods all results}. 

\item[\texttt{version}]The \textbf{version} variable returns the version of the \nr{}
translator that was in use at the time the clause we processed; in
case of interpreted execution(see chapter \ref{interpreted} on \pageref{interpreted}, it returns
the level of the current translator in use. 
\end{description}
The result of executing this exec is as follows:
\begin{alltt}
===== Exec: RCSpecialVariables =====
<super>RCSpecialVariables@4e99353f</super>
<this>RCSpecialVariables@4e99353f</this>
<class>class RCSpecialVariables</class>
<digits>9</digits>
<form>scientific</form>
<[1, 2, 3].length>
3
</[1, 2, 3].length>
<null>

</null>
<source>Java method RCSpecialVariables.nrx</source>
<sourceline>21</sourceline>
<trace>off</trace>
<version>\nr{} 3.02 27 Oct 2011</version>
Type an answer:
hello fifi
<ask>hello fifi</ask>
\end{alltt}
It might be useful to note here that these special variables are not
fixed in the sense of that they are not \emph{Reserved Variables}. \nr{}
does not have reserved variables and any of these special variables
can be used as an ordinary variable. However, when it is used as an
ordinary variable, there is no way to retrieve the special behavior.

\chapter{\nr{} Options}
\input{../ug/options}

\chapter{\nr{} as a Scripting Language}
The term \emph{scripting} is used here in the sense of using the
programming language for quickly composed programs that interact with
some application or environment to perform a number of simple tasks.

You can use \nr{} as a simple scripting language without having
knowledge of, or using any of the features that is needed in a Java
program that runs on the JVM - like defining a class name, and having
a \texttt{main} method that is static and expects an array of String
as its input. 

Scripts can be written very fast. There is
no overhead, such as defining a class, constructors and methods, and the programs contain only
the necessary instructions. In this sense, a \nr{} script looks like
an oo-version of a classic script, as the ceremonial aspects of defining
class and method can be skipped. These will be automatically generated
in the Java language source that is being generated for a script.

The scripting feature can be used for test purposes. It is an easy and convenient way of entering some statements and testing them.
The scripting feature can also be used for the start sequence of a \nr{} application.

Scripts can be interpreted or compiled - there is no rule that a
script needs to be interpreted. In both cases, interpreted or
compiled, the \nr{} translator adds the necessary overhead to enable
the JVM to execute the resulting program.

The scripting facility and its automatic generation of a class
statement can lead to one surprising message when there is
an error in the first part of the program: \emph{class x already
  implied} when the automatically generated class statement (using the
program file name) somehow clashes with the specified name that
contains the error. When not using scripting mode, this error message
nearly always indicates an error that occurred before the first class statement.

\chapter{\nr{} as an Interpreted Language}\label{interpreted}
In the JVM environment, compilation and interpretation are concepts
that are not as straightforward as in other environments; JVM code is
interpreted on several levels. When we are referring to
\emph{interpreted} \nr{} code, we indicate that there is no
intermediate Java compilation step involved. A JVM .class file is
always interpreted by the JVM runtime; the \nr{} translator is able to
execute programs without generating either .java or .class files.

This enables a very quick edit-debug-run cycle, especially when
combined with the command line feature that keeps the translator
classes resident (the -prompt option), or one of the IDE plugins for
\nr{}.

For \nr{} to deliver this functionality, the translator has been
designed to have an analogous interpret facility for every code
generation part.\footnote{This is the right way to explain this
  feature, because historically, the compiler was first (1996) and the
  interpretation facility was added later (in 2000).}

\chapter{\nr{} as a Compiled Language}
\section{Compiling from another program}
\index{compiling,from another program}

The translator may be called from a NetRexx or Java program directly, by
invoking the \emph{main} method in the \emph{org.netrexx.process.NetRexxC}
class described as follows:

\begin{lstlisting}[label=ivmain,caption=Invoking NetRexxC.main]
method main(arg=Rexx, log=PrintWriter null) static returns int
\end{lstlisting}

The \emph{Rexx} string passed to the method can be any combination of
program names and options (except \emph{-run}), as described above.
Program names may optionally be enclosed in double-quote characters (and
must be if the name includes any blanks in its specification).

A sample NetRexx program that invokes the NetRexx compiler to compile a
program called \emph{test} is:
\begin{lstlisting}[label=compiletest,caption=Compiletest]
/* compiletest.nrx */
s='test -keep -verbose4 -utf8'
say org.netrexx.process.NetRexxC.main(s)
\end{lstlisting}

Alternatively, the compiler may be called using the method:
\begin{lstlisting}[label=array,caption=Calling with Array argument]
method main2(arg=String[], log=PrintWriter null) static returns int
\end{lstlisting}
in which case each element of the \emph{arg} array must contain
either a name or an option (except \emph{-run}, as before).  In this
case, names must \emph{not} be enclosed in double-quote characters, and
may contain blanks.

\index{completion codes, from translator}
\index{return codes, from translator}
\index{PrintWriter stream for capturing translator output}
\index{capturing translator output}
For both methods, the returned \emph{int} value will be one of the
return values described above, and the second argument to the method is
an optional \emph{PrintWriter} stream.  If the \emph{PrintWriter} stream
is provided, translator messages will be written to that stream (in
addition to displaying them on the console, unless \emph{-noconsole} is
specified).
It is the responsibility of the caller to create the stream (autoflush
is recommended) and to close it after calling the compiler.
The \emph{-savelog} compiler option is ignored if a \emph{PrintWriter}
is provided (the \emph{-savelog} option normally creates
a \emph{PrintWriter} for the file \emph{NetRexxC.log}).

\textbf{Note:} NetRexxC is thread-safe (the only static properties are constants), but
it is not known whether \emph{javac} is thread-safe.  Hence the
invocation of multiple instances of NetRexxC on different threads should
probably specify \emph{-nocompile}, for safety.

\section{Compiling from memory strings}
Programs may also be compiled from memory strings by passing an array
of strings containing programs to the translator using these methods:

\begin{lstlisting}[label=frommemory,caption=From Memory]
method main(arg=Rexx, programarray=String[], log=PrintWriter null) static returns int
method main2(arg=String[], programarray=String[], log=PrintWriter null) static returns int
\end{lstlisting}

Any programs passed as strings must be named in the arg parameter before any programs contained in files are named.
For convenience when compiling a single program, the program can be
passed directly to the compiler as a String with this method:

\begin{lstlisting}[label=string,caption=With String argument]
method main(arg=Rexx, programstring=String, logfile=PrintWriter null) constant returns int
\end{lstlisting}

Here is an example of compiling a NetRexx program from a string in
memory:

\begin{lstlisting}[label=memexample,caption=Example of compiling from String]
import org.netrexx.process.NetRexxC
program = "say 'hello there via NetRexxC'"
NetRexxC.main("myprogram",program)
\end{lstlisting}

\chapter{Calling non-JVM programs}
Although \nr{} currently misses the \texttt{Address} facility that
Classic Rexx and Object Rexx do have, it is easy to call non-JVM programs
from a \nr{} program - not as easy as calling a JVM class of course, but if
the following recipe is observed, it will show not to be a major
problem. The following example is reusable for many cases.
\lstinputlisting[label=nonjava,caption=Calling Non-JVM
Programs]{../../../examples/NrxRedBk/script/NonJava.nrx} 
Just firing off a program is no big deal, but this example (in script
style) shows how easy it is to access the in- and output handles for
the environment that executes the program, which enables you to
capture the output the non-jvm program produces and do useful things
with it.\footnote{This is akin to what one would do with \emph{queue}
  on z/VM CMS and \emph{outtrap} on z/OS TSO in Classic Rexx.}
Line 17 starts the external command using the JVM \texttt{Runtime}
class in a process called \texttt{child}. In line 20 we create a
\texttt{BufferedReader} from the \texttt{child} processes'
output. This is called an InputStream but it might as well have been
called an OutputStream- everything regarding I/O is relative - but
fortunately the designers of the JVM took care of deciding this for you.
In lines 25-35 we loop through the results and show the files stored
in the zipfile. Note that we \textbf{do} (line 14) have to \textbf{catch} (line
42) the \emph{IOException} that ensues if the runtime cannot find the
\texttt{unzip} program, maybe because it is not on the path or was not
delivered with your operating system. 



Starting from JVM 1.5 releases, there is a new way to accomplish the
same goal, in a cleaner manner and with the added bonus of being able
to redirect streams, and use environment variables. In this regard,
the environment variable has made an important comeback from having
its calls deprecated, to easy to use support in the
\emph{ProcessBuilder} class. 
\lstinputlisting[label=nonjava,caption=Use of ProcessBuilder]{../../../examples/os/OSProcess.nrx} 
In the above sample, we are using two different ways to obtain the
output from a process started by the JVM from our own program. The
method \emph{outtrap} waits until the invoked process is finished and
returns all output lines in an \texttt{ArrayList}. Its name is not
entirely coincidental with the similar TSO outtrap function. 

Sometimes we cannot wait until the child process is finished, for
example when it is a long running process and we need to capture the
output on a line-by-line basis to see what is happening - in case of
the example, this was done to capture the output as part of a
testsuite for a multithreaded file transfer application, which has a
server resident process that is not supposed to end, because one of
its tasks is to poll a directory for incoming files with a specific
pattern in the file names. This is implemented using an Event based
pattern (as explained in \ref{events}  on page \pageref{events}. 
\lstinputlisting[label=nonjava,caption=Output Line
Event]{../../../examples/os/OutputLineEvent.nrx} 

\lstinputlisting[label=outputeventlistener,caption=Output Event Listener]{../../../examples/os/OutputEventListener.nrx} 

The call would look something like this:
\begin{lstlisting}[label=callosprocessexample,caption=Example of calling the OSProcess class - registering an eventhandler]
    os = OSProcess()
    os.addOutputEventListener(this)
    os.exec(command)
\end{lstlisting}

The class must \texttt{extend OutputEvenListener}, and implement this
method:

\begin{lstlisting}[label=registerhandlerexample,caption=Example of implementing the listener method]
  method outputReceived(ob=OutputLineEvent)
    this.counter = this.counter+1
    say this.counter ob.getPid() ob.getLine()
\end{lstlisting}

\chapter{Using \nr{} classes from Java}
If you are a Java programmer, using a \nr{} class from Java is just as
easy as using a Java class from \nr{}. \nr{} compiles to Java classes that can be used by Java programs.
You should import the netrexx.lang package to be able to use the short
class name for the Rexx (\nr{} string and numerics) class.

A \nr{} method without a returns keyword can return nothing, which is the void type in Java, or a Rexx string. 
\nr{}is case independent\footnote{With the default of \texttt{options
  nostrictcase} in effect.}; Java is case dependent. \nr{} generates
the Java code with the case used in the class and method
instructions. For example, if you named your class Spider in the \nr{}
source file, the resulting Java class file is Spider.class.
The public class name in your source program must match the \nr{}
source file name. For example, if your source file is \texttt{SPIDER.NRX}, and
your class is \texttt{Spider}, \nr{} generates a warning and changes the
class name to \texttt{SPIDER} to match the file name. A Java program using the
class name Spider would not find the generated class, because its name
is \texttt{SPIDER.class} - if the compile succeeded, which is not guaranteed in
case of casing mismatches.
If you have problems, compile your \nr{} program with the \textbf{options
-keepasjava -format}. You then can look at the generated java file for the correct spelling style and method parameters.

\chapter{Classes}\label{classes}
Somewhere in the nineties Object Orientation became one of the
mainstream ways to organize computer programs, and support for this
was added to programming languages. C became C++ with a preprocessor
that generates C\footnote{Cfront} that is not entirely unlike the
  \nr{} translator produces Java. Java in itself is syntax-wise a
  cleaned up version of C++, but in essence an entirely different
  language. Its inventor and architect, James Gosling, has stated on
  various occasions that he was planning a fully different syntax for
  what finally became Java - but that Sun management more or less
  forced him to use a C++ derived syntax, because C++ compilers was
  what SUN did well at the time. With Brendan Eich having to base
  JavaScript qua naming and syntax on Java, the circle that brought
  the world terse, curly braces based notations, is complete.

For an audience of Rexx programmers, the usual OO presentation goes
into the advantages of the paradigm. Today, that is not really
necessary, and OO is a given; it slightly deviates from earlier
notation as result of trying to put data and procedure into
\emph{Objects}, but it is no great deal, and this \nr{} Programmer's
Guide does not need a special section on the benefits of the OO
paradigm. It is assumed that with a few examples everyone should be
able to \emph{get} it; some old programmers might resist but there is
really no use in fighting the mainstream. Consequently, this section
discusses the way to do this in \nr{}; the way \nr{} does it is for a very
large part formed by the way the JVM dictates it, adapted to Rexx
notational style and conventions.

\section{Classes}
Classes represent a blueprint, 'cookie cutter' approach in creating
objects that do useful things. A class is defined in a file by the
same name (exceptions here for dependent classes). So a class called
Cookie is defined in a file called Cookie.nrx. Its \emph{real}, which
means its most specific name, including its package specification, is
not given by the file name but by the combination of the class=file +
the name given on the \texttt{package} statement. This enables one to
put classes in different packages without having to change the file
names.

\section{Dependent Classes}

\section{Properties}
\section{Methods}
\section{Inheritance}
\section{Overriding Methods}
\section{Overriding Properties}
\chapter{Using Packages}
Any non-toy, non-trivial program needs to be in a package. Only
examples in programming books (present company included) have programs
without package statements. The reason
for this is that there is a fairly large chance that you will give
something a name that is already used by someone else for something
else. Things are not their names\footnote{Willard Van Orman Quine, Word
  and Object, MIT Press, 1960, ISBN 0-262-67001-1}, and the same names
are given to wildly dissimilar things. The \emph{package} construct is the JVM's approach to
introducing \emph{namespaces} into the total set of programs that
programmers make. Different people will probable write some method that is
called \texttt{listDifferences} sometime. With all my software in a
package called \texttt{com.frob.nitz} and yours in a package
called \texttt{com.frob.otzim}, there is no danger of our programs
calling the wrong class and listing the wrong differences.

It is imperative to understand this chapter before continuing - it is
a mechanical nuts-and-bolts issue but an essential one at that.

\section{The package statement}
The final words about the \nr{} \textbf{package} statement is in the
\nr{} Language Reference, but the final statement about the package
\emph{mechanism} is in the JVM documentation.
\section{Translator performance consequences}
Because the \nr{} translator has to scan all packages that it can
see (meaning a recursive scan of the directories below its own level
in the directory tree, and on its classpath, it is often advisable
(and certainly if . (a dot, representing the current directory) is part of the classpath)
to do development in a subdirectory, instead of, for example, the top
level home directory. If a large number of packages and classes are
visible to the translator, compile times will be negatively impacted. 

\section{Some \nr{} package history}
All IBM versions of \nr{} had the translator in a package called
\begin{verbatim}
COM.ibm.netrexx.process 
\end{verbatim}
The official, SUN ordained
convention for package names was, to prepend the reversed domain name
of the vendor to the package name, while uppercasing the top level
domain. \nr{}, being one of the first programs to make use of
packages, followed this convention, that was quickly dropped by SUN
afterwards, probably because someone experienced what trouble it could
cause with version management software that adapted to
case-\emph{sensitive} and case-\emph{insensitive} file systems. For
\nr{}, which had started out keenly observing the rules, this
insight came late, and it is a sober fact that as a result some needlessly profane
language was uttered on occasion by some in some projects that suffered the consequences of
this. With the first RexxLA release of \nr{} in 2011, the package
name was changed to \texttt{org.netrexx}, while the runtime package
name was kept as \texttt{netrexx.lang}, because some major other
languages also follow this convention.
\section{CLASSPATH}
Most implementations of Java use an environment variable called
CLASSPATH to indicate a search path for Java classes. The Java Virtual
Machine and the \nr{} translator rely on the CLASSPATH value to find directories, zip files, and jar files which may contain Java classes. 
The procedure for setting the CLASSPATH environment variable depends on your operating system (and there may be more than one way).
\begin{itemize}
\item For Linux and Unix (BASH, Korn, or Bourne shell), use:
\begin{verbatim}
        CLASSPATH=<newdir>:\$CLASSPATH 
        export CLASSPATH
\end{verbatim}

\item Changes for re-boot or opening of a new window should be placed in your /etc/profile, .login, or .profile file, as appropriate. 
\item For Linux and Unix (C shell), use:
\begin{verbatim}
        setenv CLASSPATH <newdir>:\$CLASSPATH 
\end{verbatim}
Changes for re-boot or opening of a new window should be placed in
your .cshrc file. If you are unsure of how to do this, check the
documentation you have for installing the Java toolkit.
\item For Windows operating systems, it is best to set the system wide
  environment, which is accessible using the Control Panel (a search
  for ``environment'' offsets the many attempts to relocate the exact
  dialog in successive Windows Control Panel versions somewhat).
\end{itemize}


\chapter{Programming Patterns}
Much has been made of patterns as aggregations of higher level
embodiments of programming solutions.  It has been
observed\footnote{This observation from a Java patterns book.} that of a
number of the C++ oriented patterns in Design Patterns\footnote{Gamma,
Helm, Johnson, Vlissides, Design
Patterns: Elements of Reusable Object-Oriented Software,
Addison-Wesley Professional; 1994}, some owe their existence
to complications in the C++ language and are not readily reproducible
in a Java Patterns or Ruby Patterns book. The same goes for NetRexx-
in this chapter we would like to present a number of Java patterns
usable in NetRexx, and a number of patterns that are unique to NetRexx.
\section{Events}\label{events}

\section{Recursive Parse}
This is a pattern unique to Rexx, by virtue of Rexx having the Parse
statement. It also works in NetRexx.

\section{Observer}
The observer pattern can also be referred to as \emph{Callback}, and
the Java Event class delivers support for it. It is very usable if
some result needs to be available for a set of callers, where the set
is 0 to many. It works as follows: (see a simple implementation in
section \ref{outputeventlistener} on page
\pageref{outputeventlistener})
An object, maintains a list of its dependents, called observers, and
notifies them automatically of any state changes, usually by calling
one of their methods. It is mainly used to implement distributed event
handling systems. The Observer pattern is also a key part in the
familiar Model View Controller (MVC) architectural pattern. In the
JVM, this object needs to implement the methods of the Listener
interface; this interface specifies the addListener and RemoveListener
methods; it keeps a collection in which references to the added
listener objects are maintained. The listening is done to subclassed
Java Event classes. The event specifies the method to be called when
'firing off' and event. This means that this method is called on every
listener.

One of the larger benefits: it decouples the observer from the
subject. The subject doesn't need to know anything special about its
observers. Instead, the subject simply allows observers to
subscribe. When the subject generates an event, it simply passes it to
each of its observers. Another benefit is that event consuming classes
don't have to wait until a process is finished, and can consume events
as they come in. The OSProcess class on page
\pageref{outputeventlistener}) uses an event approach to consume
output lines from a subprocess - in the version that puts the output
in an ArrayList needs to wait for the subprocess to end, but the event
driven version can monitor a long running process and analyze output
lines whenever they are received.

\chapter{Incorporating Class Libraries}
\section{The Collection Classes}

\chapter{Input and Output}
\section{The File Class}
\section{Streams}
\section{Line mode I/O}
\subsection{Line mode I/O using BufferedReader and PrintWriter}
\subsection{Line mode I/O using BufferedReader and FileOutputStream}
\lstinputlisting[label=linecomment,caption=Buffered I?O]{../../../examples/ibm-historic/linecomment.nrx}
\section{Byte Oriented I/O}
\section{Data Oriented I/O}
\section{Object Oriented I/O using Serialization}
\section{The NIO Approach}
\chapter{Algorithms in \nr}{}
\section{Factorial}
A \emph{factorial} is the product of an integer and all the integers
below it; the mathematical symbol used is ! (the exclamation mark). For
example 4! is equal to 24 (because 4*3*2*1=24). The
following program illustrates a recursive (a method calling itself)
and an iterative approach to calculating factorials.
\lstinputlisting[label=factorial,caption=Factorial]{../../../examples/rosettacode/RCFactorial.nrx}
Executing this program yields the following result:
\begin{verbatim}
===== Exec: RCFactorial =====
Input a number: 
42
42! = 1405006117752879898543142606244511569936384000000000 (using iteration)
42! = 1405006117752879898543142606244511569936384000000000 (using recursion)
\end{verbatim}
As you can see, fortunately, both approaches come to the same
conclusion about the results. In the above program, both
approaches are a bit intermingled; for more clarity about how to use
recursion, have a look at this:
\begin{lstlisting}[label=factorialrecursive, caption=Factorial Recursive]
class Factorial
numeric digits 64

  method main(args=String[]) static
    say factorial_(42)

  method factorial_(number) static
    if number = 0 then return 1
    else return number * factorial_(number-1)

\end{lstlisting}
In this program we can clearly see that the \texttt{factorial\_} method, that
takes an argument \texttt{number} (which is of type Rexx if we do not
specify it to be another type), calls itself in the method body. This
means that at runtime, another copy of it is run, with as argument
number that the first invocation returns (the result of 42*41), and so
on.

In general, a recursive algorithm is considered more elegant, while an
iterative approach has a better runtime performance. Some language
environments are optimized for recursion, which means that their
processors can spot a recursive algorithm and optimize it by not
making many useless copies of the code. Some day in the near future
the JVM will be such an environment. Also, for some problems, for example
the processing of tree structures, using a recursive algorithm seems
much more natural, while an iterative algorithm seems complicated or forced.
\section{Fibonacci}
\lstinputlisting[label=fibonacci,caption=Fibonacci]{../../../examples/rosettacode/RCFibonacciSeq.nrx}
\chapter{Using Parse}
The \texttt{Parse} statement is one of the stalwarts of the Rexx
family of languages. 
\chapter{Using Trace}

\chapter{Concurrency}
\section{Threads}
Threads are a built-in multitasking feature of the JVM. Where earlier
JVM implementations sometime ran on so-called \emph{Green Threads},
which is a library that implements thread support for OS'ses that do
not have this facility (an
early version of Java was called \emph{GreenTalk} for this reason), modern versions
all use native OS thread support. 

A new thread is created when we create an instance of the Thread class. We cannot tell a thread which method to run, because threads are not references to methods. Instead we use the Runnable interface to create an object that contains the run method:

Every thread begins its concurrent life by executing the run method. The run method does not have any parameters, does not return a value, and is not allowed to signal any exceptions.
Any class that implements the Runnable interface can serve as a target of a new thread. An object of a class that implements the Runnable interface is used as a parameter for the thread constructor.

Threads can be given a name that is visible when listing the threads in your system. It is good practice to name every thread, because if something goes wrong you can see which threads are still running.
Additionally, threads are grouped by thread groups. If you do not
supply a thread group, the new thread is added to the thread group of
the currently executing thread. The threads of a group and their
subgroups can be destroyed, stopped, resumed, or suspended by using
the ThreadGroup object. 

The next two samples are used in the following programs that
illustrate thread usage.
\lstinputlisting[label=threads1,caption=Thread sample 1]{../../../examples/NrxRedBk/thread/ThrdTst1.nrx} 
\lstinputlisting[label=threads2,caption=Thread sample
2]{../../../examples/NrxRedBk/thread/ThrdTst2.nrx} 
The second class, Hello2, does not \emph{implement} the
\texttt{Runnable} interface, but subclasses it, so it inherits its
methods. This is a valid approach, and it is up to the developer to
choose an implementation and worry about the semantics of an inherited
thread interface.
A newly created thread remains idle until the start method is invoked. The thread then wakes up and executes the run method of its target object. The start method can be called only once. The thread continues running until the run method completes or the stop method of the thread is called.


\include{nruappl}
\chapter{Network Programming}
\section{Using Uniform Resource Locators (URL)}
\section{TCP/IP Socket I/O}
\section{RMI: Remote Method Interface}

\chapter{Database Connectivity with JDBC}
For interfacing with Relational Database Management Systems (RDBMS)
\nr{} uses the Java Data Base Connectivity (JDBC) model. This means
that all important database systems, for which a JDBC driver has
been made available, can be used from your \nr{} program. This is a
large bonus when we compare this to the other open source scripting
languages, that have been made go by with specific, nonstandard
solutions and special drivers. In contrast, \nr{} programs can be
made compatible with most database systems that use standard SQL, and,
with some planning and care, can switch database implementations at
will.
\lstinputlisting[label=jdbc,caption=A JDBC Query example]{../../../examples/NrxRedBk/jdbc/JdbcQry.nrx} 

The first peculiarity of JDBC is the way the driver class is
loaded. When most classes are 'pulled in' by the translator, a JDBC
driver traditionally is loaded through the reflection API. This
happens in line 22 with the \texttt{Class.forName} call. This implies
that the library containing this class must be on the classpath.

In line 32 we connect to the database using a url and a
userid/password combination. This is an easy way to do and test, but
for most serious applications we do not want plaintext userids and
passwords in the sourcecode, so most of the time we would store the
connection info in a file that we store in encrypted form, or we use
facilities of J2EE containers that can provide data sources that take
care of this, while at the same time decoupling your application
source from the infrastructure that it will run on.

In line 47 the query is composed by filling in variables in a Rexx
string and making a \texttt{Statement} out of it, in line 50. In line
  55, the \texttt{Statement} is executed, which yields a
  \texttt{ResultSet}. This has a \emph{cursor} that moves forward with
  each \texttt{next} call. The \texttt{next} call returns \emph{true}
  as longs as there are rows from the resultset to return.

The \texttt{ResultSet} interface implements \emph{getter} methods for
  all JDBC Types. In the above example, all returned results are of
  type \texttt{String}.

\lstinputlisting[label=jdbcu,caption=A JDBC Update
example]{../../../examples/NrxRedBk/jdbc/JdbcUpd.nrx} 
For database updates, we connect using the driver in the same way
(line 23) and now prepare the statement used for the database update
(line 50). In this example, we loop through the cursor of a select
statement and update the row in line 66. The \texttt{executeUpdate}
method of \texttt{PreparedStatement} returns the number of updated
rows as an indication of success.

From JDBC 2.0 on, cursors are updateable (and scrollable, so they can
move back and forth), so we would not have to go
through this effort - but it is a valid example of an update statement.
\chapter{WebSphere MQ}
WebSphere MQ (also and maybe better known as MQ Series) is IBM's
messaging and queing middleware, in use at a great many financial
institutions and other companies. It has, from a programming point of
view, two API's: JMS (Java Messaging Services), a generic messaging
API for the Java world, and MQI, which is older and proprietary to
IBM's product. The below examples show the MQI; other examples might
show JMS applications.

This is the sample Java application for MQI, translated (and a lot
shorter) to NetRexx.
\lstinputlisting[label=mqsample,caption=MQ Sample]{../../../examples/enterprise/wmq/MQSample.nrx}
This sample connects to the Queue Manager (called \emph{rjtestqm}) in
\emph{bindings mode}, as opposed to \emph{client mode}. Bindings mode
is only a connection possibility for client programs that are running
in the same OS image as the Queue Manager, on the server. Note that
the application connects (line 19), accesses a queue (line 23), puts a
message (line 32), gets it back (line 39) closes the queue (line 45) and disconnects (line 48) all without checking
returncodes: the exceptionhandler takes care of this, and all
irregulaties will be reported from the catch MQException block
starting at line 50).

The main method does in this case not follow the canonical form, but
has 'binary' as an extra option. Option binary can be defined on the
command line as an option to the translator, as a program option, as a
class option and as a method option. Here the smallest scope is
chosen. There is a good reason to make this method a binary method:
accessing a queue in MQ Series requires some options that are set
using a mask of binary flags - this works, in current \nr{} versions,
only in binary mode, because the operators have other semantics in
nobinary mode.

\lstinputlisting[label=mqlistener,caption=MQ Message Reader]{../../../examples/enterprise/wmq/MessageReader.nrx}
In contrast to the previous sample the MessageReader sample only has
one import statement. This is always hotly debated in project teams,
one school likes the succinctness of including only the top level
import, and only goes deeper when there is ambiguity detected; another
school spells out the all imports to the bitter end. 

The MessageReader sample connects to another queue, called TESTQUEUE1
(specified in line 7) but here we connect in \emph{client mode}, as
indicated by lines 13-15 which specify an MQEnvironment. Other
options are using an MQSERVER environment variable or a \emph{Channel
Definition Table}.

This program is also uncommon in that it uses
\texttt{MQConstants.MQGMO\_WAIT} as an option instead of being
triggered as a process by a message on a trigger queue. Using this
option means that the program waits (stays active, not really busy polling
but depending on an OS event) until a new
message arrives, which will be processed immediately.

In lines 18-21 a \emph{Channel Exit} is specified. This exit is show
in the following example.
\lstinputlisting[label=mqjavachannelexit,caption=MQ Java Channel Exit]{../../../examples/enterprise/wmq/TimeoutChannelExit.nrx}
 \lstinputlisting[label=watchdogtimer,caption=WatchdogTimer]{../../../examples/enterprise/wmq/WatchdogTimer.nrx}
MQ Series has traditional channel exits (programs that can look at the
message contents before the application gets to it). In the MQI Java
environment there is something akin to this functionality, but a Java
channel exit for MQ Series has to be defined in the application, as
shown in the previous example. The function of this particular exit is
to implement a \emph{Watchdog timer} - on a separate thread, as shown
in the sample that follows the sample channel exit. The timer
threatens here to have issues a HP OpenView alert, but that part has
been left out.

This particular sample has been designed to do something that is
normally a bit harder
to do: signal the operations department when something does NOT happen
- here the assumption is that there is a payment going over the queue
at least once every 20 minutes - when that does not happen, an alert
is issued. With every message that goes through, the timer thread is
reset, and only when it is allowed to time out, action is undertaken.

\lstinputlisting[label=watchdogtimer,caption=Publish/Subscribe]{../../../examples/enterprise/wmq/MQPubSubSample.nrx}
This sample shows the publish-subscribe interfaces that at some time have been
added to the product. This specific sample shows some Java thread
complexity but is a good example of doing publish/subscribe work in a
multithreaded way, which is a natural fit for this type of work.

\include{mqtt}

\chapter{Component Based Programming: Beans}
JavaBeans is the name for the Java component model. It consists of two
conventions, for the naming of \emph{getter} and \emph{setter} methods
for properties, and the \emph{event} mechanism for sending and
receiving events. NetRexx adds support for the automatic generation of
getter and setter methods, throught the \textbf{properties indirect}
option on the properties statement.
\include{nruapi}
\chapter{Interfacing to Open Object Rexx}
\section{BSF4ooRexx}

\chapter{NetRexx Tools}
\section{Editor support}\label{editors}
This chapter lists editors that have plugin support for \nr{},
ranging from syntax coloring to full IDE support (specified), and
Rexx friendly editors, that are extensible using Rexx as a macro
language (which can be the first step to provide \nr{} editing support).
\subsection{JVM - All Platforms}
\begin{tabularx}{\textwidth}{>{\bfseries}lX}
\toprule
JEdit & Full support for \nr{} source code editing, to be found at
\url{http://www.jedit.org}.
\\\midrule
NetRexxDE & A revisions with additions of the \nr{} plugin for
jEdit, moving to a full IDE for \nr{}. \url{http://kenai.com/projects/netrexx-misc} 
\\\midrule
Eclipse & Eclipse has a \nr{} plugin that provides a complete IDE
environment for the development of \nr{} programs (in alpha release)
by Bill Fenlason. The project is situated at SourceForge
(\url{http://eclipsenetrexx.sourceforge.net/}). Chapter
\ref{setupeclipse} on page \pageref{setupeclipse} discusses the setup
of Eclipse to build the translator itself; and has
instructions for the setup of the \nr{} plugin.
\\\bottomrule
\end{tabularx}
\subsection{Linux}
\begin{tabularx}{\textwidth}{>{\bfseries}lX}
\toprule
Emacs & netrexx-mode.el (in the \nr{} package in the \texttt{tools}
directory) runs on GNU Emacs, which is installed by default on most
Linux developer distributions.
\\\midrule
vim & vi with extensions
\\\bottomrule
\end{tabularx}
\subsection{MS Windows}
\begin{tabularx}{\textwidth}{>{\bfseries}lX}
\toprule
Emacs & netrexx-mode.el (in the \nr{} package in the \texttt{tools} directory) runs on GNU Emacs for
Windows. \url{http://www.gnu.org/software/emacs/windows/faq.html}.
\\\midrule
vim & vi with extensions
\\\bottomrule
\end{tabularx}
\subsection{MacOSX}
\begin{tabularx}{\textwidth}{>{\bfseries}lX}
\toprule
Aquamacs & A version of Emacs that is integrated with the MacOSX Aqua
look and feel. (\url{http://www.aquamacs.org}). \nr{} mode is
included in the \nr{} package in the \texttt{tools} directory.
\\\midrule
Emacs & netrexx-mode.el (in the \nr{} package) runs on GNU Emacs for
MacOSX. \url{http://www.gnu.org/software/emacs}.
\\\midrule
Vim & Vi with extensions
\\\bottomrule
\end{tabularx}
\section{Java to Nrx (java2nrx)}
When working on a piece of Java code, or an example written in the
language, sometimes it would be good if we could see the source in
NetRexx to make it more readable. This is exactly what \emph{java2nrx}
by Marc Remes does. It has a  Java 1.5 parser and an Abstract Syntax
Tree that delivers a translation to NetRexx, to the
extend of what is currently supported under NetRexx.

At the moment it is to be found at \url{http://kenai.org/NetRexx/contrib/java2nrx}

It is started by the \texttt{java2nrx.sh} script; for convenience, place \texttt{java2nrx.sh} and \texttt{java2nrx.jar} in the
same directory. NetRexxC and java must be available on the path.

Usage:
\input{../railroad/java2nrx1}
Alternatively:
\input{../railroad/java2nrx2}
\include{eclipseguide}
\chapter{Platform dependent issues}
\section{Mobile Platforms}
Android\texttrademark is a version of Linux and friendly to \nr{}
programs. Indeed, with \nr{} performing so much better than the closest
competition (jRuby, jython) on these devices, there might be a bright
future for \nr{} in these environments. 

However, there are some drawbacks, caused by the security architecture
put in place. Free, unfethered programming like one can do on a
desktop machine is a rare occurrence on these devices, and to get
programs running on them requires some knowledge of the security
architecture that has been put in place for mobile operating systems.

While Apple development still employs a closed model that allows programming only by
buying a license with accompanying certificates, and vetting by the
App Store employees, and an assumption you will program in
Objective-C, Android allows programming but not as straightforward as
we know it. To make simple command-line \nr{} programs, both device
types need to be \emph{rooted} to allow optimal access. Android allows
the installation of applications without vetting by third parties, but
dictates a programming model that incurs some overhead - which is a
drawback for the occasional scripter.
\subsection{Android}
The security model of Android is based on \emph{least needed
  privilege} and is implemented by assigning each application a
different userid, so that applications on the same device (be it a
phone or a tablet) cannot get to each others data. The consequence of
this is that simple \nr{} programming and scripting 
\subsection{Apple IOS}
Nonewithstanding the current policy of Apple to only allow Objective-C
as a programming language on the iPhone and iPad, NetRexx on IOS works fine. This is what one should do to make it work:
\begin{enumerate}
\item Jailbreak\footnote{Note that jailbreaking an iPhone is against your eula (well - Apple's eula) and might be illegal in some jurisdictions.} the device. This is necessary until a more sensible setup is used. I used Spirit; it synchs the phone with the hack and then Cydia is installed, an application that does package management the Debian way
\item Choose the "developer profile" on Cydia when asked. This applies a filter to the packages shown (or rather it doesn't) - but you need to do it in order to see the prerequisites
\item OpenTerminal will help you to do command line operations on the phone itself
\item The prerequisites are a Java VM (JamVM installs a VM and
  ClassPath, the open Java implementation) and Jikes, the Java
  compiler written in C and compiled to the native instruction set of
  the phone, which is ARM - most processors implementing this have
  \emph{Jazelle}, a specials instructionset to accelerate Java
  bytecode. However, this feature is seldom used. 
\end{enumerate}
The phone can also be logged on to using ssh from your desktop. Do not forget to change the password for the 'root' user and the 'mobile' user, as instructed in the Cydia package.

When this is done, NetRexxC.jar can be copied to the phone. I did this using 'scp NetRexxC.jar mobile@10.0.0.76:' (use the password you just set for this userid) (and because my router assigned 10.0.0.76 to the phone today). I crafted a small 'nrc' script that does a translate and then a Java compile using jikes (and I actually wrote this on the phone using an application called 'iEdit' - nano, vim and other editors are also available but I found the keyboard scheme to type in ctrl-characters a bit tedious - you type a 'ball' character and then the desired ctrl char, while shifting the virtual keyboard through different modes):

nrc:
\begin{verbatim}
java -cp ~/NetRexxC.jar COM.ibm.netrexx.process.NetRexxC $*
\end{verbatim}
Now we can do a compile of the customary hello.nrx with './nrc -keep -nocompile hello' (notice that this is all in the home directory of the 'mobile' user, just like the jar that I just copied. The resulting hello.java.keep can then be mv'ed to hello.java and compiled with 'jikes hello.java'. This produces a class that can be run with 'java -cp NetRexxC.jar hello'
\section{IBM Mainframe: Using \nr{} programs in z/OS batch}
Traditionally the mainframe was a batch oriented environment, and much
of the workload that counts still executes in this way. To be able to
use NetRexx with Job Control Language (JCL) in batch address spaces,
accessing traditional datasets and interacting with the console when
needed, we need to know a bit more. This will be explained in these paragraphs.

A standard component of z/OS since version 1.8 or so is \texttt{jzos},
which acts as glue between the unix-like abstractions the JVM works
with and the time tested way of working on z/OS, with its SAM and VSAM
datasets, its Partitioned Data Set (PDS) file organization, the ICF
Catalogs and console address space; all of which in existence long
before Java reared its head in our IT environments.

The manuals will teach you that there are several ways to
interact with HFS/OMVS resources in JCL, but the alternatives to
\texttt{jzos} have so many drawbacks that it is the only
sensible way to run \nr{} programs in the batch environment. 

\chapter{Translator inner workings}
\include{resolution}

\backmatter
% \listoffigures
% \listoftables
% \lstlistoflistings
\printindex
\clearpage
\psset{unit=1in}
\begin{pspicture}(3.5,1in)
  \psbarcode{\isbn}{includetext guardwhitespace}{isbn}
\end{pspicture}
\end{document} 
